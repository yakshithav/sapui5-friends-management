import { join, split, tail } from "lodash";

/**
 * calculate CF endpoint from tenant label or return the default endpoint from CF_API_ENDPOINT
 */
export function getCFEndpoint(): string {
  const envLandscapeLabel = process.env.TENANT_LANDSCAPE_LABEL;
  if (!envLandscapeLabel || !envLandscapeLabel.startsWith("cf")) {
    return process.env.CF_API_ENDPOINT || "";
  }

  let label: string;
  if (envLandscapeLabel.endsWith("hotfix")) {
    label =
      envLandscapeLabel === "cf-us10-002-hotfix"
        ? "us10-002-hotfix.hanavlab"
        : "hotfixaws.hanavlab";
  } else {
    label = envLandscapeLabel.endsWith("canary")
      ? "sap.hana"
      : `${join(tail(split(envLandscapeLabel, "-")), "-")}.hana`;
  }
  return `https://api.cf.${label}.ondemand.com`;
}
