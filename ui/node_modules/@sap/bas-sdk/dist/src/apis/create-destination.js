"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDestination = void 0;
const url_join_1 = __importDefault(require("url-join"));
const axios_1 = __importDefault(require("axios"));
const core_utils_1 = require("../utils/core-utils");
const headers_helper_1 = require("./headers-helper");
const destinations_1 = require("../utils/destinations");
/**
 * add new destination
 */
async function createDestination(destinaionInfo) {
    const flatDestination = (0, destinations_1.destinationInfoToAnswerDestination)(destinaionInfo);
    const reqURL = (0, url_join_1.default)((0, core_utils_1.getEnvValue)(destinations_1.ENV_H2O_URL), "/api/createDestination");
    try {
        /* Axios exposes the version in the user-agent header, creating a security issue.
        To address this, we override the header for enhanced security.*/
        const headers = {
            "Content-Type": "application/json",
            "User-Agent": "Bas",
        };
        const reqConfig = {
            method: "post",
            url: reqURL,
            headers: (0, headers_helper_1.addJwtHeader)(headers),
            data: flatDestination,
        };
        await axios_1.default.request(reqConfig);
    }
    catch (err) {
        throw new Error(`Couldn't create the destination from the (${reqURL}) URL because of the following error: ${err.message}. Error code=${err.response.status}`);
    }
}
exports.createDestination = createDestination;
//# sourceMappingURL=create-destination.js.map