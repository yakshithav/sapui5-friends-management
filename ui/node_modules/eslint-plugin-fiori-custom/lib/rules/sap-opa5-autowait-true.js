/**
 * @fileoverview Checks if autowait is true in Opa5.extendConfig
 * @author Syed Arij Hussain
 */

//------------------------------------------------------------------------------
// Rule Definition
//------------------------------------------------------------------------------

module.exports = {
    create: function (context) {
        "use strict";

        const ERROR_MSG_AUTOWAIT_TRUE = "Autowait must be true.";
        const ERROR_MSG_AUTOWAIT_PRESENT = "Autowait must be present and true in extendConfig.";

        //----------------------------------------------------------------------
        // Helpers
        //----------------------------------------------------------------------

        // any helper functions should go here or else delete this section

        //----------------------------------------------------------------------
        // Public
        //----------------------------------------------------------------------

        return {

            CallExpression(node) {
                if (node.callee.type == 'MemberExpression') {
                    if (node.callee.object.name === "Opa5") {
                        if (node.callee.property.name === "extendConfig") {
                            if (node.arguments[0].type == 'ObjectExpression') {
                                var propsList = node.arguments[0].properties;
                                let ifautoWaitExists = false;
                                let boolValueAutoWait;
                                for (var property in propsList) {
                                    var key = propsList[property].key.name;
                                    if (key == 'autoWait') {
                                        ifautoWaitExists = true;
                                        boolValueAutoWait = propsList[property].value.value;
                                    }
                                }
                                if (!ifautoWaitExists) {
                                    context.report(node, ERROR_MSG_AUTOWAIT_PRESENT);
                                } else {
                                    if (!boolValueAutoWait) {
                                        context.report(node, ERROR_MSG_AUTOWAIT_TRUE);
                                    }

                                }
                            }
                            
                        }
                        
                    }
                }
            }
        };
    }
};