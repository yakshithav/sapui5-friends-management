"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateCdm = generateCdm;
const fs_1 = require("fs");
const path_1 = require("path");
const types_1 = require("../types");
/**
 * Generates a CDM by embedding the provided app tiles into the FLP homepage.
 *
 * @param apps - A list of app to be embedded.
 * @returns The generated CDM configuration
 */
function generateCdm(apps = {}) {
    const cdm = JSON.parse((0, fs_1.readFileSync)((0, path_1.join)(__dirname, '../../templates/flp/cdm.base.json'), 'utf-8'));
    // add apps
    Object.keys(apps).forEach((id) => {
        const appId = apps[id].additionalInformation.split('=')[1];
        const vizId = `VIZ:${appId}`;
        const [object, action] = id.split('-');
        const { title, description, url } = apps[id];
        // add app to default catalog
        cdm.catalogs[types_1.FLPHomePageDefaults.catalogId].payload.viz.push(vizId);
        // create flp visualization
        cdm.visualizations[vizId] = {
            'vizType': 'sap.ushell.StaticAppLauncher',
            'businessApp': appId,
            'vizConfig': {
                'sap.app': {
                    title,
                    subTitle: description
                },
                'sap.flp': {
                    'target': {
                        'appId': appId,
                        'inboundId': `${object}-${action}`,
                        'parameters': [
                            {
                                'name': 'sap-ui-tech-hint',
                                'value': 'UI5'
                            }
                        ]
                    }
                }
            }
        };
        // create flp application
        cdm.applications[appId] = {
            'sap.app': {
                id: appId,
                title,
                crossNavigation: {
                    inbounds: {
                        [`${object}-${action}`]: {
                            'semanticObject': object,
                            'action': action,
                            title,
                            'subTitle': description,
                            'signature': {
                                'additionalParameters': 'allowed'
                            }
                        }
                    }
                }
            },
            'sap.ui5': {
                'componentName': appId
            },
            'sap.ui': {
                'technology': 'UI5'
            },
            'sap.platform.runtime': {
                'componentProperties': {
                    url,
                    'asyncHints': {}
                }
            }
        };
        // add app to default section
        cdm.pages[types_1.FLPHomePageDefaults.pageName].payload.sections[types_1.FLPHomePageDefaults.sectionId].layout.vizOrder.push(appId);
        cdm.pages[types_1.FLPHomePageDefaults.pageName].payload.sections[types_1.FLPHomePageDefaults.sectionId].viz[appId] = {
            id: appId,
            vizId
        };
    });
    return cdm;
}
//# sourceMappingURL=cdm.js.map