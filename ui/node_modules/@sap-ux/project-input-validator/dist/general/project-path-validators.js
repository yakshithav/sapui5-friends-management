"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateFioriAppTargetFolder = validateFioriAppTargetFolder;
const project_access_1 = require("@sap-ux/project-access");
const path_1 = require("path");
const i18n_1 = require("../i18n");
const validators_1 = require("../ui5/validators");
const validators_2 = require("./validators");
/**
 * Returns true if the specified target path does not contain an SAP Fiori project.
 *
 * @param targetDir the target directory path.
 * @returns true, if not Fiori Project, or string message indicating that the path contains an SAP Fiori project.
 */
async function validateFioriAppProjectFolder(targetDir) {
    // Check if the target directory contains a CAP project
    if (!!(await (0, project_access_1.findCapProjectRoot)(targetDir, false)) || !!(await (0, project_access_1.getCapProjectType)(targetDir))) {
        return (0, i18n_1.t)('ui5.folderContainsCapApp');
    }
    // Check if the target directory contains an SAP Fiori project
    const appRoot = await (0, project_access_1.findRootsForPath)(targetDir);
    if (appRoot) {
        return (0, i18n_1.t)('ui5.folderContainsFioriApp', { path: appRoot.appRoot });
    }
    else {
        return true;
    }
}
/**
 * Validates whether the specified target path is suitable for creating an SAP Fiori project App project.
 * The function performs the following checks:
 *
 * 1. **CAP Project Check:** If `validateFioriAppFolder` is true, it checks if the target path is part of an existing CAP project.
 *    - Uses `findCapProjectRoot()` and `getCapProjectType()` to verify the presence of a CAP project.
 *    - Returns an error message if a CAP project is detected.
 *
 * 2. **Fiori App Project Check:** If `validateFioriAppFolder` is true, it checks if the target path contains an SAP Fiori project.
 *    - Uses `findRootsForPath()` to determine if an SAP Fiori project application root exists.
 *    - Returns a success message if a valid SAP Fiori app root is found, otherwise returns true.
 *
 * 3. **General Project Folder Check:**
 *    - Uses `validateProjectFolder()` to verify if the provided target path exists.
 *    - Ensures the target folder does not already contain a subfolder with the intended project name.
 *
 * 4. **Windows Path Length Validation:**
 *   - Validates the combined path length of the target directory and application name against the Windows max path length limit (256 characters).
 *
 * @param targetPath - The target directory path where the SAP Fiori app is to be created.
 * @param appName - The application directory name.
 * @param validateFioriAppFolder - If true, validates the target path as an SAP Fiori App project folder.
 * @returns A boolean value `true` if all validations pass; otherwise, an error message.
 */
async function validateFioriAppTargetFolder(targetPath, appName, validateFioriAppFolder) {
    if (validateFioriAppFolder === true) {
        const isFioriValid = await validateFioriAppProjectFolder(targetPath);
        if (isFioriValid !== true) {
            return isFioriValid;
        }
    }
    const isProjectValid = (0, validators_1.validateProjectFolder)(targetPath, appName);
    if (isProjectValid !== true) {
        return isProjectValid;
    }
    // Windows path length validation
    const winPathResult = (0, validators_2.validateWindowsPathLength)((0, path_1.join)(targetPath, appName), (0, i18n_1.t)(`general.windowsFolderPathTooLong`));
    if (winPathResult !== true) {
        return winPathResult;
    }
    return true;
}
//# sourceMappingURL=project-path-validators.js.map