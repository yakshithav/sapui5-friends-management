"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCFAbapInstanceChoices = getCFAbapInstanceChoices;
const cf_tools_1 = require("@sap/cf-tools");
const error_handler_1 = require("../error-handler/error-handler");
const i18n_1 = require("../i18n");
const btp_utils_1 = require("@sap-ux/btp-utils");
/**
 * Get the name sorted list of ABAP instance choices from an active CF login. If not logged in, an error message is logged.
 *
 * @param errorHandler The error handler instance used to log and retain messages for use in prompts
 * @returns The list of ABAP instance choices
 */
async function getCFAbapInstanceChoices(errorHandler) {
    const choices = [];
    try {
        const filteredInstances = [
            btp_utils_1.AbapEnvType.ABAP,
            btp_utils_1.AbapEnvType.ABAP_TRIAL,
            btp_utils_1.AbapEnvType.ABAP_CANARY,
            btp_utils_1.AbapEnvType.ABAP_OEM,
            btp_utils_1.AbapEnvType.ABAP_OEM_CANARY,
            btp_utils_1.AbapEnvType.ABAP_HAAS,
            btp_utils_1.AbapEnvType.ABAP_STAGING,
            btp_utils_1.AbapEnvType.ABAP_INTERNAL_STAGING
        ];
        // Load additional ABAP service types to extend the filtered instance list
        const envFilteredInstances = process.env.ABAPEnvServiceTypes
            ? process.env.ABAPEnvServiceTypes.split(',').map((item) => item.trim())
            : [];
        const serviceInstanceInfo = await (0, cf_tools_1.apiGetServicesInstancesFilteredByType)([
            ...filteredInstances,
            ...envFilteredInstances
        ]);
        if (serviceInstanceInfo.length > 0) {
            serviceInstanceInfo.forEach((service) => {
                choices.push({ name: service['label'], value: service });
            });
        }
        else {
            // No envs found
            errorHandler.logErrorMsgs(error_handler_1.ERROR_TYPE.NO_ABAP_ENVS, (0, i18n_1.t)('errors.noAbapEnvsInCFSpace'));
        }
    }
    catch (error) {
        // Cannot connect to CF
        errorHandler.logErrorMsgs(error_handler_1.ERROR_TYPE.NO_ABAP_ENVS, (0, i18n_1.t)('errors.abapEnvsCFDiscoveryFailed'));
    }
    return choices.sort((a, b) => (a.name ? a.name.localeCompare(b.name ?? '') : 0));
}
//# sourceMappingURL=cf-helper.js.map